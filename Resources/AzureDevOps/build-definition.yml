resources:
  repositories:
  - repository: self
  - repository: dfc-devops
    type: github
    name: SkillsFundingAgency/dfc-devops
    ref: refs/heads/NCSD-226-AddInitialAzDevOpsYamlTemplates
    endpoint: 'GitHub (CDH)'

jobs:
- job: TestBranchName
  displayName: TestBranchName
  pool: Continuous Integration 02 - SSD - 160ACU

  steps:
  - task: PowerShell@2
    name: ExecuteTestBranchNameScript
    displayName: Test-BranchName
    inputs:
     targetType: 'filePath'
     filePath: 'Resources/PSScripts/Test-BranchName.ps1'
     arguments: '-BranchName $(Build.SourceBranchName) -Verbose'

- job: BuildDotNetFramework
  displayName: Build-DotNetFramework
  dependsOn: TestBranchName
  condition: and(succeeded(), eq(dependencies.TestBranchName.outputs['ExecuteTestBranchNameScript.FunctionAppVersion'], 'Version1'))
  pool:
    name: Continuous Integration 02 - SSD - 160ACU
    demands:
    - msbuild
    - visualstudio
#Your build pipeline references an undefined variable named �GitVersion.MajorMinorPatch�.
  variables:
    SolutionBaseName: 'NCS.DSS.ActionPlan'

  steps:
  - template: AzureDevOpsTemplates/Build/dfc-dotnetframework-build.yml@dfc-devops
    parameters:
      SolutionBaseName: $(SolutionBaseName)
      BuildPlatform: 'any cpu'
      BuildConfiguration: 'release'

- job: Job_1
  displayName: Build-DotNetStandard
  dependsOn: TestBranchName
  condition: and(succeeded(), eq(variables['Build.SourceBranchName'], 'master-v2'))
  pool:
    name: Continuous Integration 02 - SSD - 160ACU

#Task group has not been exported, task groups are not supported yet




